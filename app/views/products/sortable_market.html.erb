<link rel="stylesheet" href="/assets/jquery-ui.css">
<script src="/assets/jquery-ui.js"></script>
  <style rel="stylesheet" type="text/css">
	body{
		padding-top:20px;
	}
	.navbar{
		display:none;
	}
	.container{
		margin-left:5px;
	}
  .connectedSortable {
		list-style-type: none;
		margin:0; 
		padding:0; 
		height:100%; 
		margin: 0 5px 0 10px; 
		min-width:130px; 
		outline:1px solid;
	}
  .connectedSortable li{
		margin: 0 0 1px 0; 
		padding: 5px; 
		font-size: 14px; 
		width: 120px; 
		cursor:move; 
	}
	#head{
		position:fixed;
		margin-top:-22px;
		background-color:#fff;
		font-size:16px;
	}
	#head td{
		width:144px;
	}
  </style>
  <script>
	
	
	$(function() {
			<% keys = Product::MARKET_AREA.keys %>
			keys = <%= sanitize Product::MARKET_AREA.keys.to_s %>
			
			$('<%= sanitize "#"+keys.join(",#") %>').sortable({
	        connectWith: '.connectedSortable',
	        placeholder: 'placeholder',
	        stop: function() {
						for (var i=0; i<keys.length; i++) {
							list = $('#'+keys[i]+' li');
							
							ids = new Array(list.length);
							$.each(list,function(j, n) {
								ids[j] = $(n).attr("product_id")
							});
							
							if(list.length > 0){
								$.ajax({
									type: "POST",
									url: "/products/update_market",
									data: { "market_area": keys[i], "ids": ids }
								})
							}
						}
	        }
	    }).disableSelection();
	});
  </script>
	<table>
		<tr id="head">
			<% Product::MARKET_AREA.each do |key, val| %>
				<td>
					<div style="width:140px; text-align:center;">
					<%= val %>
					</div>
				</td>
			<% end %>
		</tr>
		<tr>
			<% Product::MARKET_AREA.each do |key, val| %>
				<% list = @products.where(market_area: key).order(:market_sort) %>
				<%  @height = list.size*33 if key=="xiaocai" %>
				<td valign="top" style="height:<%= @height %>px;">
					<ul id="<%= key %>" class="connectedSortable">
						<% list.each do |product| %>
							<li class="ui-state-default" classify="<%= product.classify %>" product_id="<%= product.id %>">
								<%#= product.market_sort.to_s.rjust(2, '0') %> <%= product.product_name %>
							</li>
						<% end %>
					</ul>
				</td>
			<% end %>
		</tr>
	</table>

 

	
 

