<link rel="stylesheet" href="/assets/jquery-ui.css">
<link rel="stylesheet" href="/assets/products_print.css">
<style>
.connectedSortable li{
	font-size:14px;
}

</style>
<script src="/assets/jquery-ui.js"></script>
  <script>
	
	
	$(function() {
			<% p keys = params[:type].constantize::CLASSIFY.keys %>
			keys = <%= sanitize params[:type].constantize::CLASSIFY.keys.to_s %>
			
			$('<%= sanitize "#"+keys.join(",#") %>').sortable({
	        connectWith: '.connectedSortable',
	        placeholder: 'placeholder',
	        stop: function() {
						for (var i=0; i<keys.length; i++) {
							list = $('#'+keys[i]+' li');
							
							ids = new Array(list.length);
							$.each(list,function(j, n) {
								ids[j] = $(n).attr("product_id")
							});
							
							if(list.length > 0){
								$.ajax({
									type: "POST",
									url: "/products/update_sn",
									data: { "classify": keys[i], "ids": ids }
								})
							}
						}
	        }
	    }).disableSelection();
	});
	
	
	
	
  </script>
	<table>
		<tr id="print-title">
			<!-- <td colspan="6"><div>称重打码用</div></td> -->
		</tr>
		<tr id="head">
			<% Vegetable::CLASSIFY.each do |key, val| %>
				<% if key == "leaf" %>
					<td>
						<div style="text-align:center;">
							<%= val %>
						</div>
					</td>
				<% end %>
				<td>
					<div style="text-align:center;">
						<%= val %>
					</div>
				</td>
			<% end %>
		</tr>
		
		<tr>
			<% Vegetable::CLASSIFY.each do |key, val| %>
			<% p key %>
				<%  @height = 20*25 %>
				<% list = @products.where(classify: key).order(:pinyin) %>
				<td valign="top" style="height:<%= @height %>px;">
					<ul id="<%= key %>" class="connectedSortable">
						<% list.each_with_index do |product, index| %>
							<li class="ui-state-default" classify="<%= product.classify %>" product_id="<%= product.id %>">
								<div class="pull-left">
									<span class="shengmu"><%= shengmu = product.pinyin[0] %></span>
									<!-- <span class="product_id"><%= product.id %></span> -->
									<%= product.product_name %>
								</div>

								<span class="pull-right">
									<% if params[:show_price].present? %>
										<%= product.sales_price(1, nil) %><%= product.unit %>
									<% else %>
										<%= product.order_unit %>
									<% end %>
									
									
								</span>
								<!-- <% product.order_spid.each do |key, value| %>
								<% next if value==0 %>
									<div class="pull-left" style="font-size:12px; line-height:12px; padding: 0 2px;">
											<div><%= "#{key}#{product.unit}" %></div>
											<div style="color:red;"><%= value %>包</div>
									</div>
								<% end %> -->
							</li>
							<% if index == 19 %>
								</ul>
							</td>
							<td valign="top" style="height:<%= @height %>px;">
								<ul class="connectedSortable ui-sortable">
							<% end %>
						<% end %>
					</ul>
				</td>
			<% end %>
			
			<!-- <% list = @products.where(classify: 'nil') %>
			<td valign="top" style="height:<%= @height %>px;">
				<ul id="nil" class="connectedSortable">
					<% list.each do |product| %>
						<li class="ui-state-default" classify="<%= product.classify %>" product_id="<%= product.id %>">
							<%= product.product_name %>
						</li>
					<% end %>
				</ul>
			</td> -->
			
		</tr>
	</table>
		

 

	
 

