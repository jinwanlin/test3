/*
* Copyright (c) 2013 Johannes Mittendorfer (http://johannes-mittendorfer.com)
* Licensed under the MIT License (LICENSE.txt).
*
* Version 1.1.5 2013-12-01 
*/

(function(){!function(a){"use strict";return a.fn.EAN13=function(b,c){var d,e,f;return e={prefix_offset:.07,font_stretch:.078,border_line_height_number:.9,border_line_height:1,line_height:.9,font_size:.2,font_y:1.03},f=a.extend({number:!0,prefix:!0,onValid:function(){},onInvalid:function(){},onError:function(){},color:"#000"},c),d=this[0],this.each(function(){var c,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(t=function(b){var c,d,e;return e=null,c=b.split(""),d=0,a.each(c,function(a,b){return d+=a%2===0?parseInt(b,10):3*parseInt(b,10)}),e=d%10===0?!0:!1},t(b)?f.onValid.call(this):f.onInvalid.call(this),v=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],w=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],x=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],k=["xxxxxx","xxyxyy","xxyyxy","xxyyyx","xyxxyy","xyyxxy","xyyyxx","xyxyxy","xyxyyx","xyyxyx"],u=f.prefix?.8*d.width:d.width,f.number?(c=e.border_line_height_number*d.height,l=e.line_height*c):(c=e.border_line_height*d.height,l=e.line_height*c),n=u/95,i="",g=k[parseInt(b.substr(0,1),10)].split(""),s=b.substr(0,1),b=b.substr(1),r=b.split(""),m=0;6>m;)i+="x"===g[m]?v[r[m]]:w[r[m]],m++;for(m=6;12>m;)i+=x[r[m]],m++;if(!d.getContext)return f.onError.call(this);for(j=d.getContext("2d"),j.fillStyle=f.color,o=f.prefix?d.width*e.prefix_offset:0,p=i.split(""),j.fillRect(o,0,n,c),o+=2*n,j.fillRect(o,0,n,c),o+=n,m=0;42>m;)"1"===p[m]&&j.fillRect(o,0,n,l),o+=n,m++;for(o+=n,j.fillRect(o,0,n,c),o+=2*n,j.fillRect(o,0,n,c),o+=2*n,m=42;84>m;)"1"===p[m]&&j.fillRect(o,0,n,l),o+=n,m++;return j.fillRect(o,0,n,c),o+=2*n,j.fillRect(o,0,n,c),f.number?(j.font=e.font_size*l+"px monospace",f.prefix&&j.fillText(s,0,c*e.font_y),q=3*n+(f.prefix?e.prefix_offset*d.width:0),h=b.substr(1,6).split(""),a.each(h,function(a,b){return j.fillText(b,q,c*e.font_y),q+=e.font_stretch*u}),q=49*n+(f.prefix?e.prefix_offset*d.width:0),a.each(b.substr(6).split(""),function(a,b){return j.fillText(b,q,c*e.font_y),q+=e.font_stretch*u})):void 0})}}(jQuery)}).call(this);